<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Zen-Dashboard — ZenFlare</title>
  <link rel="icon" type="image/svg+xml" href="../assets/icons/favicon.svg" />
  <meta name="theme-color" content="#000000" />
  <meta name="color-scheme" content="dark" />
  <style>
    html { background: #000 !important; }
    :root {
      --bg: #000000;
      --bg-soft: #0a0a0a;
      --text: #e5e5e5;
      --text-muted: rgba(255,255,255,0.6);
      --calm: rgba(255,255,255,0.15);
      --warning: rgba(255, 180, 80, 0.6);
      --problem: rgba(255, 80, 80, 0.8);
      --flare-glow: rgba(255,200,120,0.2);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      background: #000 !important;
      background-color: var(--bg) !important;
      color: var(--text) !important;
      font-family: system-ui, -apple-system, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    .header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .header img {
      width: 48px;
      height: 48px;
      object-fit: contain;
    }
    .header h1 { font-size: 1.5rem; margin: 0; }
    .tagline {
      font-size: 0.875rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }
    .servers {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .server {
      width: 160px;
      padding: 1.25rem;
      border-radius: 14px;
      background: var(--bg-soft);
      border: 1px solid rgba(255,255,255,0.08);
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    .server .name { font-weight: 600; margin-bottom: 0.5rem; }
    .flame {
      width: 52px;
      height: 68px;
      margin: 0.5rem auto;
      border-radius: 50% 50% 45% 45%;
      animation: breathe 2.5s ease-in-out infinite;
    }
    .flame.calm {
      background: radial-gradient(ellipse at 50% 100%, var(--calm), transparent 70%);
      box-shadow: 0 0 20px var(--calm);
    }
    .flame.warning {
      background: radial-gradient(ellipse at 50% 100%, var(--warning), transparent 70%);
      box-shadow: 0 0 24px var(--warning);
    }
    .flame.problem {
      background: radial-gradient(ellipse at 50% 100%, var(--problem), transparent 70%);
      box-shadow: 0 0 28px var(--problem);
    }
    @keyframes breathe {
      0%, 100% { transform: scale(1); opacity: 0.9; }
      50% { transform: scale(1.08); opacity: 1; }
    }
    .load {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }
    .back {
      margin-top: 2rem;
    }
    .back a {
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.875rem;
    }
    .back a:hover { color: var(--text); }
    .waves {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 120px;
      pointer-events: none;
      opacity: 0.15;
    }
    .wave {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 60'%3E%3Cpath fill='none' stroke='%23fff' stroke-width='2' d='M0 30 Q300 0 600 30 T1200 30'/%3E%3C/svg%3E") repeat-x;
      background-size: 600px 60px;
      animation: wave 8s linear infinite;
    }
    .wave:nth-child(2) { animation-delay: -4s; opacity: 0.6; }
    @keyframes wave {
      0% { transform: translateX(0); }
      100% { transform: translateX(-600px); }
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="../assets/logo.png" alt="ZenFlare" id="logo" />
    <div>
      <h1>Zen-Dashboard</h1>
      <p class="tagline">From first line to production. No noise, just flow.</p>
    </div>
  </div>
  <div class="servers" id="servers"></div>
  <div class="back">
    <a href="../">← Back to ZenFlare</a>
  </div>
  <div class="waves">
    <div class="wave"></div>
    <div class="wave"></div>
  </div>
  <script>
    const statusClass = (s) => s === "calm" ? "calm" : s === "warning" ? "warning" : "problem";
    const base = (() => {
      const p = window.location.pathname;
      if (p.includes("/ZenFlare/")) return "/ZenFlare";
      return "";
    })();
    const logo = document.getElementById("logo");
    logo.onerror = () => { logo.style.display = "none"; };
    async function load() {
      try {
        const r = await fetch(base + "/api/dashboard/state");
        const data = await r.json();
        document.getElementById("servers").innerHTML = data.servers.map(s => `
          <div class="server">
            <div class="name">${s.name}</div>
            <div class="flame ${statusClass(s.status)}" title="Load: ${(s.load * 100).toFixed(0)}%"></div>
            <div class="load">${(s.load * 100).toFixed(0)}%</div>
          </div>
        `).join("");
      } catch (e) {
        document.getElementById("servers").innerHTML = `
          <div class="server">
            <div class="name">API</div>
            <div class="flame calm"></div>
            <div class="load">30%</div>
          </div>
          <div class="server">
            <div class="name">Worker</div>
            <div class="flame warning"></div>
            <div class="load">80%</div>
          </div>
          <div class="server">
            <div class="name">DB</div>
            <div class="flame calm"></div>
            <div class="load">50%</div>
          </div>
        `;
      }
    }
    load();
    setInterval(load, 5000);
  </script>
</body>
</html>
